%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%                           NO ROTOR SOLUTION

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{No-rotor Solution: Axisymmetric Panel Method}
\label{sec:axisymmetricpanelmethod}

One of the major pieces of the DuctTAPE solver is an axisymmetric panel method.
The implementation for an axisymmetric panel method is similar to the implementation of typical planar panel methods, but there are a few differences.
We include here details for the axisymmetric method used.

\subsection{Theory}
\label{ssec:axisymmetricpaneltheory}

\subsubsection{Basics}

\begin{figure}[h!]
	\centering
	\includegraphics[width=0.65\textwidth]{./ductape/figures/panel_geometry}
	\caption{General overview of the geometry of the panel method.}
	\label{fig:panel_geometry}
\end{figure}





%The fundamental mathematics for the axisymmetric panel method are identical to the methods covered previously in that we wish to solve for the singularity strengths that satisfy the no flow through condition, \(\vect{V} \cdot ~\hat{n} = 0\).
%To be clear, for bodies of revolution, we want to solve the following set of equations
%
%\begin{equation}
%	\left( \vect{V}_\infty - \vect{V}_{mn} \right) \cdot \hat{n}_m = 0
%\end{equation}\todo{missing summation}
%
%\where \(\vect{V}_\infty\) is the freestream velocity vector, \(\vect{V}_{mn}\) is the velocity induced on the \(i\)th panel by the singularities distributed across all of the \(j\)th panels, and \(\hat{n}_m\) is the vector normal to the \(i\)th panel.
%
%It is often conceptually convenient to place the freestream on the right hand side of the equation and consider it as boundary conditions for the system
%
%\begin{equation}
%	\vect{V}_{mn} \cdot \hat{n}_m = \vect{V}_\infty \cdot \hat{n}_m
%\end{equation}

Similar to many planar panel methods, we begin with a Fredholm integral equation of the second kind, and forego the derivation up this this point as it is found elsewhere.\todo{probably want to include this in the planar panel methods chapter and reference it here. though may need to come back and fill it all in anyway if panel method stuff takes a different direction}
For our usage here, we will take the boundary integral equation from Martensen \cite{Lewis_1991}.

\begin{equation}
	\label{eqn:fredholm1}
	-\frac{1}{2}\gamma(s_m) + \oint k(s_m, s_n) \gamma(s_n) \d s_n + V_\infty (\cos \alpha_\infty \cos \beta_m + \sin \alpha_\infty \sin \beta_m) = 0
\end{equation}

\where \(-\frac{1}{2}\gamma(s_m)\), physically speaking, is the velocity discontinuity from the center of a vorticity sheet to the body surface beneath the sheet at a point \(s_m\) along a surface.
The integral is taken clockwise about the surface (see \cref{fig:panel_geometry}) such that a positive \(k(s_m, s_n)\), which is the velocity induced at, and parallel to, the surface at a point \(s_m\) by a unit vortex at a point \(s_n\), is in the positive integration direction.
Multiplying \(k(s_m,s_n)\) by the vortex sheet strength and integrating over the surface gives to total induced velocity by the surface on a point \(s_m\).
The final term represents the components of the freestream velocity parallel to a point \(s_m\), taking into account the angle of attack \(\alpha_\infty\) and the local surface slope, \(\beta_m\).
Note that this is equivalent to specifying the Dirichlet boundary condition, because vorticity is equal to the difference in velocities just outside and just inside a given vortex sheet.
Since the internal velocity of the body is zero, the body surface velocity is equivalent to the vorticity at the surface.

\begin{align}
	\gamma(s)\d s &= (v_{s_\text{out}} - v_{s_\text{in}})\d s \\
	v_{s_\text{in}} &= 0 \\
	v_s &= v_{s_\text{out}} =  \gamma(s).
\end{align}

In the axisymmetric case, we can simplify the boundary conditions by assuming that the freestream velocity is solely in the axial direction (required for the axisymmetric assumption), meaning the freestream angle of attack is zero.
This leaves us with only \(V_\nfty\cos\beta_m\) as the freestream contribution.
Since, as before, we will be casting this integral equation as a system of linear equations, we can reorganize in preparation for more details in the following sections.

\begin{equation}
\label{eqn:fredholmintegral}
	-\frac{1}{2}\gamma(s_m) + \oint k(s_m, s_n) \gamma(s_n) \d s_n = - V_\infty \cos \beta_m
\end{equation}


\subsubsection{Ring Vortices}

%\section{re-write of ring vortex derivation}
%
%start with vorticity is curl of velocity field
%
%\begin{equation}
%	\label{eqn:vorticity_fundamental}
%	\vect{\omega} = \nabla \times \vect{V}
%\end{equation}
%
%define the streamfunction to be
%
%\begin{equation}
%	\vect{V} = \nabla \times \vect{\psi}
%\end{equation}
%
%substituting in streamfunction to \cref{eqn:vorticity_fundamental} we arrive at the Poisson equation
%
%\begin{equation}
%	\label{eqn:poisson}
%	\nabla^2 \vect{\psi} = -\vect{\omega}
%\end{equation}
%
%Solve \cref{eqn:poisson} using the Green's function for the 3D Laplacian\todo{consider deriving this too}.
%
%\begin{equation}
%	G(\vect{r}) = \frac{-1}{4\pi |\vect{r}|}
%\end{equation}
%
%such that the solution for the vector potential (streamfunction) is
%
%\begin{equation}
%	\label{eqn:poisson_integral}
%	\begin{aligned}
%	\vect{\psi} &= \int_\mathcal{V} \frac{-1(-\vect{\omega})}{4\pi |\vect{r}|} \\
%			 &= \frac{1}{4\pi}\int_\mathcal{V} \frac{\vect{\omega}}{ |\vect{r}|}
%	\end{aligned}
%\end{equation}
%
%
%Define a ring in cylindrical space that has constant radius, \(r_o\), and constant circulation, \(\vect{\Gamma}=\Gamma\hat{e}_\theta\), such that the ring may be appropriately represented as axisymmetric, and thus any induced velocity will be solely in the \(\hat{e}_r\) and \(\hat{e}_x\) directions with no tangential induction.\todo{add picture here}
%
%In cylindrical coordinates, the vector potential of such a vortex ring \cref{eqn:poisson_integral} becomes
%
%\begin{equation}
%	\label{eqn:poisson_integral_cyl}
%		\vect{\psi} = \frac{1}{4\pi} \int^\infty_\infty \int^\infty_\infty \int^{\pi}_{-\pi} \frac{\vect{\omega}}{ |\vect{r}|} r_o \d \theta \d r \d x
%\end{equation}
%
%Then, to formally reduce the vorticity to the ring (making a ring singularity, similar to point singularities used in the previous chapter), we use the Dirac delta functions such that
%
%\begin{equation}
%	\vect{\omega} = \Gamma\delta(x-x_o)\delta(r-r_o)\hat{e}_\theta
%\end{equation}
%
%plugging in (remember \(\Gamma=\) constant)
%
%\begin{equation}
%	\label{eqn:poisson_integral_gamma}
%	\vect{\psi} = \frac{\Gamma}{4\pi} \int^\infty_\infty \int^\infty_\infty \int^{\pi}_{-\pi} \frac{\delta(x-x_o)\delta(r-r_o)\hat{e}_\theta}{ |\vect{r}|} r_o \d \theta \d r \d x
%\end{equation}
%
%by the definition of the Dirac delta function, and bring the constant \(r_o\) out of the integral
%
%\begin{equation}
%	\label{eqn:poisson_integral_simplified}
%	\vect{\psi} = \frac{\Gamma r_o}{4\pi} \int^{\pi}_{-\pi} \frac{\hat{e}_\theta}{ |\vect{r}|} r_o \d \theta
%\end{equation}
%
%Since we have made the axisymmetric assumption, we can choose an \((x,y)\) datum plane on which to work.
%By so doing, we can take
%
%\clearpage
%\newpage


The next piece to consider is the expression for the coupling coefficient, \(k(s_m,s_n)\), which is the velocity induced by a ring vortex of unit strength at \(s_n\) parallel to the surface at \(s_m\).
This is the major difference between the planar and axisymmetric panel methods---the use of ring singularity distributions in axisymmetric case rather than point distributions in the planar case.
Note that one could replace, or combine, the vortex surface with another singularity (given the appropriate expression for \(k\) in the integral equation), but in our application here, we will stick with vortices.

As we explain where our final expression of the coupling coefficient comes from, it will be helpful to provide a picture of the geometry that we are working with.
\Cref{fig:axisym_fundamental_geometry} shows the influence of a section of ring vortex on the surface at point \(s_n\), with the vorticity being defined as positive according to the right hand rule, in the positive \(\theta\) direction, where \(\theta\) is positive about the \textit{negative}\sidenote{This will be convenient later for positive rotor conventions} x-direction.

\begin{figure}[h!]
	\centering
	\includegraphics[width=0.75\textwidth]{./ductape/figures/axisym_fundamental_geometry}
	\caption{Figure showing the application of the Biot-Savart Law from Lewis \cite{Lewis_1991}.}
	\label{fig:axisym_fundamental_geometry}
\end{figure}

Specifically, \cref{fig:axisym_fundamental_geometry} shows the application of the Biot-Savart Law to a short vortex element of length, \(\d s= r_n\theta'\).
Given a vortex ring strength of \(\Gamma\), and a tangent vector in direction, \(\hat{t}\), the differential velocity, \(\d \vect{q}\), induced at a point that is positioned at a vectorial distance of \(\vect{R}\) is

\begin{equation}
\label{eqn:biotsavart}
	\d \vect{q} = \frac{\Gamma \d s \hat{t} \times \vect{R}}{4\pi|\vect{R}|^3}.
\end{equation}

Given the coordinate system of \cref{fig:axisym_fundamental_geometry}, that is, defining the meridional (\(x,r\)) plane to be at \(\theta'=0\) such that the unit vectors \(\hat{i}\) and \(\hat{j}\) lie in the \(x\) and \(r\) directions respectively, with \(\hat{k}\) perpendicular to the meridional plane, we can give specific expressions for the unit tangent vector, \(\hat{t}\), and vector, \(\vect{R}\):

\begin{align}
	\hat{t} &= -\sin(\theta')\hat{j} - \cos(\theta')\hat{k} \\
	\vect{R} &= (x_m - x_n)\hat{i} + (r_m \cos \theta - r_n \cos \theta')\hat{j} - (r_m \sin \theta - r_n \sin \theta')\hat{k}.
\end{align}

Thus

\begin{equation}
\begin{split}
	\hat{t} \times \vect{R} =& \bigg[ \left(r_m \sin \theta \sin \theta' - r_n \sin^2 \theta' \right) \hat{i} \\
 	-& \left((x_m-x_n) \cos \theta' \right) \hat{j} \bigg] \\
	-&\bigg[ \left(-r_m \cos \theta \cos \theta' + r_n \cos^2 \theta' \right) \hat{i} \\
 	-& \left((x_m-x_n) \sin \theta' \right) \hat{k} \bigg].
\end{split}
\end{equation}

\noindent Applying the following trigonometric identities to the values in the \(\hat{i}\) groups allows us to simplify.

\begin{align}
\sin^2 \theta + \cos^2 \theta &= 1 \\
\sin a \sin b + \cos a \cos b &= \cos(a-b),
\end{align}

\begin{equation}
	\begin{split}
		\hat{t} \times \vect{R} =& \left(r_m \cos(\theta-\theta') - r_n \right) \hat{i} \\
		-& (x_m-x_n) \cos \theta'  \hat{j} \\
		+& (x_m-x_n) \sin \theta'  \hat{k}.
	\end{split}
\end{equation}

Plugging back into \cref{eqn:biotsavart}, and realizing that the magnitude of \(\vect{R}\) is (utilizing those same trigonometric identities):

\begin{equation}
	\begin{aligned}
		|\vect{R}| &= \left[(x_m-x_n)^2 + (r_m\cos\theta - r_n \cos\theta')^2 + (r_m \sin \theta - r_n \sin \theta')^2\right]^{1/2} \\
		&\begin{split}= \big[(x_m-x_n)^2 &+ r_m^2\cos^2\theta +r_n^2 \cos^2\theta' - 2r_mr_n\cos\theta\cos\theta' \\
			&+ r_m^2 \sin^2 \theta + r_n^2 \sin^2 \theta' - 2r_mr_n\sin\theta\sin\theta'\big]^{1/2} \end{split}\\
		&\begin{split}= \big[(x_m-x_n)^2 &+ r_m^2(\cos^2\theta + \sin^2 \theta) +r_n^2 (\cos^2\theta' + \sin^2 \theta') \\
			 & -2r_mr_n (\cos\theta\cos\theta'+ \sin\theta\sin\theta')\big]^{1/2} \end{split} \\
		&= \left[(x_m-x_n)^2 + r_m^2 + r_n^2 - 2 r_m r_n \cos(\theta-\theta')\right]^{1/2},
	\end{aligned}
\end{equation}

\noindent we have

\begin{equation}
	\begin{split}
	\d \vect{q} =& \frac{\Gamma \d s }{4\pi|\vect{R}|^3} \left(r_m \cos(\theta-\theta') - r_n \right) \hat{i} \\
	&- (x_m-x_n) \cos \theta'  \hat{j}
	+ (x_m-x_n) \sin \theta'  \hat{k}.
	\end{split}
\end{equation}

\noindent If we integrate over \(\theta'\) from 0 to \(2\pi\), the \(\hat{k}\) component vanishes due to symmetry, and we are left with the expressions for the velocity induced by the entire ring:

\begin{equation}
	\begin{aligned}
		v_{x_{mn}} &= \frac{-\Gamma}{4\pi} \int_0^{2\pi} \left[ \frac{r_n - r_m\cos(\theta - \theta')}{\left[(x_m-x_n)^2 + r_m^2 + r_n^2 - 2 r_m r_n \cos(\theta-\theta')\right]^{3/2}} \right]\d\theta' \\
		v_{r_{mn}} &= \frac{-\Gamma}{4\pi} \int_0^{2\pi} \left[ \frac{(x_m-x_n)\cos(\theta')}{\left[(x_m-x_n)^2 + r_m^2 + r_n^2 - 2 r_m r_n \cos(\theta-\theta')\right]^{3/2}} \right]\d\theta'
	\end{aligned}
\end{equation}

%\where by symmetry, the \(\hat{k}\) component vanishes, and we are left with the \(\hat{i}\) component in the axially induced velocity, \(v_{x_{mn}}\), and the \(\hat{j}\) component in the radially induced velocity, \(v_{r_{mn}}\).

We are now finally ready to define the coupling coefficient, which is, as stated before, equal to the velocity induced by the \(n\)th ring vortex panel parallel to the \(m\)th panel control point.

\begin{equation}
	k(s_m, s_n)  = -v_{x_{mn}} \cos\beta_m - v_{r_{mn}} \sin\beta_m,
\end{equation}

\where \(\beta_m\) is the local slope defined as

\begin{equation}
	\beta_m = \tan^{-1} \frac{\d r_m}{\d x_m}
\end{equation}

\noindent at the point, \(s_m\), as shown in \cref{fig:panel_geom_closeup_m}.
Also note that because of the direction of the vortex (positive in the positive \(\theta\) direction), the individual induced velocities are in the negative \(x\) and \(r\) directions, requiring a multiplication by \(-1\) in order to have \(k(s_m,s_n)\) be positive in the direction of integration as we stated previously.


\begin{figure}[h!]
	\centering
	\includegraphics[width=0.65\textwidth]{./ductape/figures/panel_geom_closeup_m}
	\caption{Geometry at a discretized location on the body surface.}
	\label{fig:panel_geom_closeup_m}
\end{figure}


%\begin{figure}[h!]
%	\centering
%	\includegraphics[width=0.65\textwidth]{./ductape/figures/axisympanelgeometry}
%	\caption{Panel Geometry Definitions}
%	\label{fig:axisym_panel_geometry}
%\end{figure}

Now it is possible to take the integrals in the induced velocity expressions, but several individuals have noted that it is more computationally convenient to express the induced velocities in terms of elliptic integrals, which allow for fast look up tables to provide solutions to the elliptic integrals.
Taking the expressions as presented in Lewis \cite{Lewis_1991} the axial, \(v_{x_{mn}}\), and radial \(v_{r_{mn}}\), components of velocity induced by a ring vortex of unit strength (meaning we set the \(\Gamma\) values to one) can be expressed as:

%\begin{equation}
%	\label{eqn:vortexringcoefficient}
%	\begin{aligned}
%		v_{x_{mn}}^\gamma &= - \frac{1}{2 \pi r_n \left(x^2 + (r+1)^2 \right)^{1/2}} \left[ K(m) -   \left( 1 + \frac{2(r-1)}{x^2 + (r-1)^2} \right) E(m)  \right] \\
%		v_{r_{mn}}^\gamma &= \frac{x/r}{2 \pi r_n \left(x^2 + (r+1)^2 \right)^{1/2}}  \left[ K(m) -   \left( 1 + \frac{2r}{x^2 + (r-1)^2} \right) E(m)  \right]
%	\end{aligned}
%\end{equation}

\begin{equation}
	\label{eqn:ringvortexinducedvelocity}
	\eqbox{
	\begin{aligned}
		v_{x_{mn}}^\gamma &=  \frac{1}{2 \pi r_n} \frac{1}{\left[\xi^2 + (\rho+1)^2 \right]^{1/2}} \left[ K(\sin^2\phi) -   \left( 1 + \frac{2(\rho-1)}{\xi^2 + (\rho-1)^2} \right) E(\sin^2\phi)  \right] \\
		v_{r_{mn}}^\gamma &= -\frac{1}{2 \pi r_n} \frac{\xi/\rho}{\left[\xi^2 + (\rho+1)^2 \right]^{1/2}}  \left[ K(\sin^2\phi) -   \left( 1 + \frac{2\rho}{\xi^2 + (\rho-1)^2} \right) E(\sin^2\phi)  \right]
	\end{aligned}
}
\end{equation}

\where the superscript, \(\gamma\), indicates values relative to vortices (as opposed to sources as will be introduced later), \(K(\sin^2\phi)\) and \(E(\sin^2\phi)\) are complete elliptic integrals of the first and second kind, respectively, and

\begin{equation}
	\label{eqn:normalizedgeom}
	\begin{aligned}
		\sin^2 \phi &= \left( \frac{4\rho}{\xi^2 + (\rho+1)^2} \right) \\% = k^2 = \sin^2(\phi)\\
		\xi &= \frac{x_m - x_n}{r_n} \\
		\rho &= \frac{r_m}{r_n}
	\end{aligned}
\end{equation}

\begin{figure}[h!]
	\centering
	\includegraphics[width=0.65\textwidth]{./ductape/figures/axisympaneldistances}
	\caption{Distance Components: note that the vortex here is positive according to the right hand rule, about the positive theta direction, which is positive in a left hand coordinate system, see \cref{fig:axisym_fundamental_geometry} for the whole picture.}
	\label{fig:axisym_panel_distances}
\end{figure}

\where \([x_m, r_m]\) is the location of the point being influenced (e.g.~the \(i\)th panel control point when solving on a specific body) in cylindrical coordinates, and \([x_n,r_n]\) is the location of the \(j\)th ring vortex (the ring vortex located at the \(j\)th panel control point that influences the \(i\)th panel) in cylindrical coordinates.
It is safe enough to think of these as analogous to the [x,y] coordinates in a planar panel method.


As the modular angle, \(\phi\), approaches \(\pi/2\), The elliptic integrals become singular.
For cases where the modular angle approaches \(\pi/2\), we can set \(K\) and \(E\) using the asymptotic expressions:% \todo{this is wrong. this applies near pi/2, but things are still singular at pi/2...}

\begin{equation}
	\begin{aligned}
		K(\phi) &= \ln \frac{4}{\cos \phi} \\
		E(\phi) &= 1 + \frac{1}{2} \left( K(\phi) - \frac{1}{1.2}\right) \cos^2 \phi,
	\end{aligned}
\end{equation}

\noindent respectively.\sidenote{Note that for the case where \(\phi = \pi/2\), we use self-induced expressions given below.}

%It may also be noted that, for these nearly singular cases, we could use alternative expressions (namely, the planar expressions) for \(v_x\) and \(v_r\) when \[\left[ \xi^2 + (\rho-1)^2 \right]^{1/2} \lesssim 0.01:\]
%
%\begin{equation}
%	\begin{aligned}
%		v_{x_{mn}} = \frac{\rho-1}{2 \pi \left[ \xi^2 + (\rho-1)^2 \right]^{1/2}} \\
%		v_{r_{mn}} = -\frac{\xi}{2 \pi \left[ \xi^2 + (\rho-1)^2 \right]^{1/2}},
%	\end{aligned}
%\end{equation}
%
%\noindent but applying these alterations is unnecessary if we are already applying special treatment to the elliptic integrals.


\subsubsection{Discretization}
\label{sssec:vortexcoefficients}

Now that we have all the components for the integral equation, we want to cast the problem as a linear system of equations through discretizing the surface into individual panels, with control points at the panel centers.
This allows us to approximate the contour integral using the trapezoid method\todo{probably want to derive this as well...}.
Thus we cast \cref{eqn:fredholmintegral} as a system of \(N\) equations, where the \(m\)th equation is expressed as

\begin{equation}
	\label{eqn:eqn_m}
	\eqbox{
	\sum_{n=1}^N a_{mn} \gamma_n = -V_\infty \cos \beta_m
}
\end{equation}

\where\sidenote{The \(-\gamma_m/2\) term is absorbed into the \(a_{mm}\) term as explained below.}

\begin{equation}
	\label{eqn:vringamn}
	\eqbox{
		a_{mn} = k(s_m,s_n)d_n = \left( -v_{x_{mn}} \cos \beta_m - v_{r_{mn}}\sin \beta_m \right) d_n ~~\text{for}~m\neq n
	}
\end{equation}

\where \(d_n\) is the length of the \(n\)th panel, and \(\beta_m\) is the slope of the \(m\)th panel (see again \cref{fig:panel_geom_closeup_m}).
The panel slopes are calculated similar to the local slope mentioned above, but in the discretized case we have

%\begin{equation}
%	\beta =
%	\begin{cases}
	%		sign(\Delta \hat{r}) \frac{pi}{2}~~~&\mathrm{if}~~~ |\Delta \hat{x}| < 1e-5 \\
	%		\tan^{-1}\frac{\Delta \hat{r}}{\Delta \hat{x}}~~~&\mathrm{if}~~~ \Delta \hat{x} > 1e-5
	%	\end{cases}
%\end{equation}

\begin{equation}
	\beta_m = \tan^{-1}\frac{\Delta {r}_m}{\Delta {x}_m}
\end{equation}

\where

\begin{equation}
	\begin{aligned}
		\Delta {r}_m &= r_{m_2} - r_{m_1} \\
		\Delta {x}_m &= x_{m_2} - x_{m_1},
	\end{aligned}
\end{equation}

%\noindent thus
%
%\begin{equation}
%	\begin{aligned}
%		\Delta \hat{r}_m &= \sin \beta_m \\
%		\Delta \hat{x}_m &= \cos \beta_m.
%	\end{aligned}
%\end{equation}


\noindent For cases when the panels have negative \(\Delta x\) values in our reference frame, we provide corrections to the arc-tangent calculation.\todo{look at atan2 again to see if that works}

\begin{equation}
	\beta =
	\begin{cases}
		\beta + \pi ~~~&\mathrm{if~panel~is~on~bottom~of~geometry}\\
		\beta - \pi ~~~&\mathrm{if~panel~is~on~top~half~of~geometry}
	\end{cases}
\end{equation}

\paragraph{Self-induced Case}
For the self-induced case, that is when \(m=n\) and the panel is inducing velocity on itself,\sidenote{In other words, as noted above, the modular angle in the elliptic ingetrals is exactly \(\pi/2\).} we need to take a few things into consideration.

First, as noted above, the \(-\gamma/2\) term from \cref{eqn:fredholmintegral} is absorbed into the \(a_{mm}\) term, so we will have a \(-1/2\) as part of the expression for self-induced velocity.

For the remaining pieces of the self-induced velocity, we need to consider the various curvatures present in the geometry.
The panels of the axisymmetric panel method, though flat, should be thought of as curved for the purposes of attributing self-induced velocities.
\Cref{fig:axisym_selfinduced_geometry} shows the two curvatures associated with the axisymmetric panels.
The first curvature that leads to a self-induced velocity is the curvature in the \((x,r)\) plane, the same plane in which a planar method would be developed.
In this case, we can reasonably use the self-induced velocity used for the planar case, as long as we assume that \(d_m/r_m\) is small, which it will be except at stagnation points for bodies of revolution, where the local vorticity will be small anyway.

\begin{figure}[h!]
	\centering
	\includegraphics[width=0.75\textwidth]{./ductape/figures/axisym_selfinduced_geometry}
	\caption{Depictions of the curvature in the two planes, taken from Lewis \cite{Lewis_1991}}
	\label{fig:axisym_selfinduced_geometry}
\end{figure}

For the self-induced velocity due to the curvature in the \((x,r)\) plane, we start with the standard planar vortex influence coefficient expressions for a vortex of unit strength with induced velocity components of

\begin{align}
	v_{x_{mn}} &= \frac{r_m - r_n}{2 \pi r^2_{mn}} d_n \\
	v_{r_{mn}} &= \frac{x_m - x_n}{2 \pi r^2_{mn}} d_n,
\end{align}

\noindent and putting them together into the influence coefficient (coupling coefficient multiplied by panel length)

\begin{equation}
	a^\text{plane}_{mm} = \frac{d_m}{2 \pi} \lim_{m\rightarrow n} \left[\frac{(r_m - r_n)\cos \beta_m  - (x_m - x_n)\sin \beta_m}{(x_m - x_n)^2+(r_m - r_n)^2}\right].
\end{equation}

\noindent Note that we want to find the value for the affect of the panel on itself, so we apply the limit as \(m\) approaches \(n\).

We next note the following definitions for sine and cosine of the panel angle, \(\beta_m\):

\begin{align}
	\cos \beta_m  &= \frac{\d x_m}{\d s_m} \\
	\sin \beta_m  &= \frac{\d r_m}{\d s_m};
\end{align}

\noindent which we can substitute into our expression to yield

\begin{equation}
	\label{eqn:aplanemmlimit}
	a^\text{plane}_{mm} = \frac{d_m}{2 \pi} \lim_{m\rightarrow n} \left[\frac{(r_m - r_n) \frac{\d x_m}{\d s_m}  - (x_m - x_n)\frac{\d r_m}{\d s_m}}{(x_m - x_n)^2+(r_m - r_n)^2}\right].
\end{equation}

Since this is indeterminate, we apply L'Hospital's rule, taking derivatives with respect to the differential length along the surface,\(s_m\), and treating the \(n\)th terms as constants.
We will work out the numerator first, then the denominator before putting everything back together.

For the first term in the numerator, applying the product rule gives:

\begin{equation}
	\frac{\d}{\d s_m} \left[ (r_m-r_n)\frac{\d x_m}{\d s_m}\right] = \left(\frac{\d r_m}{\d s_m} - \frac{\d r_n}{\d s_m} \right) \frac{\d x_m}{\d s_m} + (r_m-r_n)\frac{\d^2 x_m}{\d s_m^2},
\end{equation}

\noindent which we can simplify slightly, remembering that we are taking \(n\)th terms as constants

\begin{equation}
	\left(\frac{\d r_m}{\d s_m} - \cancel{\frac{\d r_n}{\d s_m}} \right) \frac{\d x_m}{\d s_m} + (r_m-r_n)\frac{\d^2 x_m}{\d s_m^2} =  \frac{\d r_m}{\d s_m} \frac{\d x_m}{\d s_m} + (r_m-r_n)\frac{\d^2 x_m}{\d s_m^2}.
\end{equation}

We approach the second term of the numerator in the same manner,

\begin{equation}
	\begin{aligned}
		\frac{\d}{\d s_m} \left[ (x_m-x_n)\frac{\d r_m}{\d s_m}\right] &= \left(\frac{\d x_m}{\d s_m} - \cancel{\frac{\d x_n}{\d s_m}} \right) \frac{\d r_m}{\d s_m} + (x_m-x_n)\frac{\d^2 r_m}{\d s_m^2}\\
		&= \frac{\d x_m}{\d s_m} \frac{\d r_m}{\d s_m} + (x_m-x_n)\frac{\d^2 r_m}{\d s_m^2}.
	\end{aligned}
\end{equation}

\noindent Putting the terms of the numerator together (remebering to subtract the second term from the first) we see that the \(\frac{\d x_m}{\d s_m} \frac{\d r_m}{\d s_m}\) terms cancel out, leaving us with a numerator of

\begin{equation}
	(r_m-r_n)\frac{\d^2 x_m}{\d s_m^2} - (x_m-x_n)\frac{\d^2 r_m}{\d s_m^2}
\end{equation}

Next we look at the denominator of \cref{eqn:aplanemmlimit}.
Applying the chain rule to the first term in the denominator, and removing derivatives of constants yields

\begin{equation}
	\begin{aligned}
		\frac{\d}{\d s_m} (x_m-x_n)^2 &= 2(x_m-x_n)\left(\frac{\d x_m}{\d s_m}-\cancel{\frac{\d x_n}{\d s_m}}\right)\\
		&= 2(x_m-x_n)\frac{\d x_m}{\d s_m}.
	\end{aligned}
\end{equation}

\noindent Similarly for the second term in the denominator:

\begin{equation}
	\begin{aligned}
		\frac{\d}{\d s_m} (r_m-r_n)^2 &= 2(r_m-r_n)\left(\frac{\d r_m}{\d s_m}-\cancel{\frac{\d r_n}{\d s_m}}\right)\\
		&= 2(r_m-r_n)\frac{\d r_m}{\d s_m}.
	\end{aligned}
\end{equation}

\noindent Combining the two terms gives us the complete denominator

\begin{equation}
	2\left[(x_m-x_n)\frac{\d x_m}{\d s_m} + (r_m-r_n)\frac{\d r_m}{\d s_m}\right].
\end{equation}

Putting the numerator and denominator back together, and taking the 2 in the denominator out of the limit gives us

\begin{equation}
	a^\text{plane}_{mm} = \frac{d_m}{4 \pi} \lim_{m\rightarrow n} \left[\frac{(r_m-r_n)\frac{\d^2 x_m}{\d s_m^2} - (x_m-x_n)\frac{\d^2 r_m}{\d s_m^2}}{(x_m-x_n)\frac{\d x_m}{\d s_m} + (r_m-r_n)\frac{\d r_m}{\d s_m}}\right],
\end{equation}

\noindent which we can see is still indeterminate.
So we will apply L'Hospital's rule once again.

Beginning again with the first term of the numerator:

\begin{equation}
	\begin{aligned}
		\frac{\d}{\d s_m} \left[(r_m-r_n)\frac{\d^2 x_m}{\d s_m^2}\right] &= \left(\frac{\d r_m}{\d s_m} - \cancel{\frac{\d r_n}{\d s_m}}\right)\frac{\d^2 x_m}{\d s_m^2}+(r_m-r_n)\frac{\d^3 x_m}{\d s_m^3}\\
		&= \frac{\d r_m}{\d s_m} \frac{\d^2 x_m}{\d s_m^2}+(r_m-r_n)\frac{\d^3 x_m}{\d s_m^3}.
	\end{aligned}
\end{equation}

\noindent Then the second term of the numerator:

\begin{equation}
	\begin{aligned}
		\frac{\d}{\d s_m} \left[(x_m-x_n)\frac{\d^2 r_m}{\d s_m^2}\right] &= \left(\frac{\d x_m}{\d s_m} - \cancel{\frac{\d x_n}{\d s_m}}\right)\frac{\d^2 r_m}{\d s_m^2}+(x_m-x_n)\frac{\d^3 r_m}{\d s_m^3}\\
		&= \frac{\d x_m}{\d s_m} \frac{\d^2 r_m}{\d s_m^2}+(x_m-x_n)\frac{\d^3 r_m}{\d s_m^3}.
	\end{aligned}
\end{equation}

Now the first term of the denominator:

\begin{equation}
	\begin{aligned}
		\frac{\d}{\d s_m} \left[(x_m-x_n)\frac{\d x_m}{\d s_m}\right] &= \left(\frac{\d x_m}{\d s_m} - \cancel{\frac{\d x_n}{\d s_m}}\right)\frac{\d x_m}{\d s_m}+(x_m-x_n)\frac{\d^2 x_m}{\d s_m^2}\\
		&= \left(\frac{\d x_m}{\d s_m}\right)^2+(x_m-x_n)\frac{\d^2 x_m}{\d s_m^2}.
	\end{aligned}
\end{equation}

\noindent And the second term of the denominator:

\begin{equation}
	\begin{aligned}
		\frac{\d}{\d s_m} \left[(r_m-r_n)\frac{\d r_m}{\d s_m}\right] &= \left(\frac{\d r_m}{\d s_m} - \cancel{\frac{\d r_n}{\d s_m}}\right)\frac{\d r_m}{\d s_m}+(r_m-r_n)\frac{\d^2 r_m}{\d s_m^2}\\
		&= \left(\frac{\d r_m}{\d s_m}\right)^2+(r_m-r_n)\frac{\d^2 r_m}{\d s_m^2}.
	\end{aligned}
\end{equation}

\noindent Putting everything back together (remembering again that the second term in the numerator is subtracted) gives

\begin{equation}
	a^\text{plane}_{mm} = \frac{d_m}{4 \pi} \lim_{m\rightarrow n} \left[\frac{\frac{\d r_m}{\d s_m} \frac{\d^2 x_m}{\d s_m^2}+(r_m-r_n)\frac{\d^3 x_m}{\d s_m^3}-\frac{\d x_m}{\d s_m} \frac{\d^2 r_m}{\d s_m^2}-(x_m-x_n)\frac{\d^3 r_m}{\d s_m^3}}{\left(\frac{\d x_m}{\d s_m}\right)^2+(x_m-x_n)\frac{\d^2 x_m}{\d s_m^2}+\left(\frac{\d r_m}{\d s_m}\right)^2+(r_m-r_n)\frac{\d^2 r_m}{\d s_m^2}}\right].
\end{equation}

Taking the limit now, give us

\begin{equation}
	\label{eqn:planarselfinduced1}
	a^\text{plane}_{mm} = \frac{d_m}{4 \pi} \frac{\frac{\d r_m}{\d s_m} \frac{\d^2 x_m}{\d s_m^2}-\frac{\d x_m}{\d s_m} \frac{\d^2 r_m}{\d s_m^2}}{\left(\frac{\d x_m}{\d s_m}\right)^2+\left(\frac{\d r_m}{\d s_m}\right)^2}.
\end{equation}


Although this expression can be uses as-is, Lewis \cite{Lewis_1991} proposed the introduction of a transformation that can further simplify this expression, removing the need for curve fitting procedures.

He begins with the transformations

\begin{align}
	\frac{\d r_m}{\d s_m} &= \frac{\d r_m}{\d x_m}\frac{\d x_m}{\d s_m}\\
	\frac{\d^2 r_m}{\d s_m^2} &= \frac{\d^2 r_m}{\d x_m^2}\left(\frac{\d x_m}{\d s_m}\right)^2 + \frac{\d r_m}{\d x_m}\frac{\d^2 x_m}{\d s_m^2}.
\end{align}

Applying these transformations to \cref{eqn:planarselfinduced1} and simplifying leads to

\begin{align}
	a^\text{plane}_{mm} &= \frac{d_m}{4 \pi}
	\frac{
		\frac{\d r_m}{\d x_m}\frac{\d x_m}{\d s_m} \frac{\d^2 x_m}{\d s_m^2}
		-\frac{\d x_m}{\d s_m} \left[\frac{\d^2 r_m}{\d x_m^2}\left(\frac{\d x_m}{\d s_m}\right)^2
		+ \frac{\d r_m}{\d x_m}\frac{\d^2 x_m}{\d s_m^2} \right]
	}{
		\left(\frac{\d x_m}{\d s_m}\right)^2
		+ \left(\frac{\d r_m}{\d x_m}\right)^2\left(\frac{\d x_m}{\d s_m}\right)^2
	} \\
	%
	&= \frac{d_m}{4 \pi}
	\frac{
		\frac{\d r_m}{\d x_m}\cancel{\frac{\d x_m}{\d s_m}} \frac{\d^2 x_m}{\d s_m^2}
		- \cancel{\frac{\d x_m}{\d s_m}}  \left[\frac{\d^2 r_m}{\d x_m^2}\left(\frac{\d x_m}{\d s_m}\right)^2
		+ \frac{\d r_m}{\d x_m}\frac{\d^2 x_m}{\d s_m^2} \right]
	}{
		\left(\frac{\d x_m}{\d s_m}\right)^{\cancel{2}}
		+ \left(\frac{\d r_m}{\d x_m}\right)^2\left(\frac{\d x_m}{\d s_m}\right)^{\cancel{2}}
	} \\
	%
	&= \frac{d_m}{4 \pi}
	\frac{
		\cancel{\frac{\d r_m}{\d x_m} \frac{\d^2 x_m}{\d s_m^2}}
		-  \left[\frac{\d^2 r_m}{\d x_m^2}\left(\frac{\d x_m}{\d s_m}\right)^2
		+ \cancel{\frac{\d r_m}{\d x_m} \frac{\d^2 x_m}{\d s_m^2}} \right]
	}{
		\frac{\d x_m}{\d s_m}
		+ \left(\frac{\d r_m}{\d x_m}\right)^2 \frac{\d x_m}{\d s_m}
	} \\
	%
	&= \frac{d_m}{4 \pi}
	\frac{
		- \frac{\d^2 r_m}{\d x_m^2}\left(\frac{\d x_m}{\d s_m}\right)^{\cancel{2}}
	}{
		\cancel{\frac{\d x_m}{\d s_m}}
		+ \left(\frac{\d r_m}{\d x_m}\right)^2\cancel{\frac{\d x_m}{\d s_m}}
	} \\
	%
	\label{eqn:planarselfinduced2}
	&= \frac{d_m}{4 \pi}
	\frac{
		- \frac{\d^2 r_m}{\d x_m^2} \frac{\d x_m}{\d s_m}
	}{
		1 + \left(\frac{\d r_m}{\d x_m}\right)^2
	}.
\end{align}

\noindent We can then eliminate the \(\d x_m/ \d s_m\) term by applying the Pythagorean theorem such that

\begin{align}
	\d s_m^2 &= \d x_m^2 + \d r_m^2 \\
	\left(\frac{\d s_m}{\d x_m}\right)^2 &= \left(\frac{\d x_m}{\d x_m}\right)^2 + \left(\frac{\d r_m}{\d x_m}\right)^2 \\
	\frac{\d s_m}{\d x_m} &= \left[1 + \left(\frac{\d r_m}{\d x_m}\right)^2\right]^{1/2} \\
	\frac{\d x_m}{\d s_m} &= \frac{1}{\left[1 + \left(\frac{\d r_m}{\d x_m}\right)^2\right]^{1/2} }
\end{align}

\noindent Which substituted into \cref{eqn:planarselfinduced2} leaves

\begin{align}
	a^\text{plane}_{mm} &= \frac{d_m}{4 \pi}
	\frac{
		- \frac{\d^2 r_m}{\d x_m^2} \frac{1}{\left[1 + \left(\frac{\d r_m}{\d x_m}\right)^2\right]^{1/2} }
	}{
		\left(\frac{\d r_m}{\d x_m}\right)^2
	} \\
	%
	&= \frac{d_m}{4 \pi}
	\frac{
		- \frac{\d^2 r_m}{\d x_m^2}
	}{
		\left[1 + \left(\frac{\d r_m}{\d x_m}\right)^2\right]^{1/2} \left[1 + \left(\frac{\d r_m}{\d x_m}\right)^2\right]
	} \\
	%
	&= \frac{d_m}{4 \pi}
	\frac{
		- \frac{\d^2 r_m}{\d x_m^2}
	}{
		\left[1 + \left(\frac{\d r_m}{\d x_m}\right)^2\right]^{3/2}
	}
\end{align}

Realizing that the formula for the internal radius of curvature is

\begin{equation}
	R_m = \frac{
		\left[1 + \left(\frac{\d r_m}{\d x_m}\right)^2\right]^{3/2}
	}{
		-\frac{\d^2 r_m}{\d x_m^2}
	},
\end{equation}

\noindent we are left with the simple expression

\begin{equation}
	a^\text{plane}_{mm} = \frac{d_m}{4 \pi R_m}.
\end{equation}

We can further simplify this expression by putting it in terms of the external curvature which we approximate as

\begin{equation}
	\Delta \beta_m = \frac{\beta_{m+1} - \beta_{m-1}}{2}
\end{equation}

\noindent for all but the trailing edge panels.
We set \(\Delta \beta_m = 0\) for the trailing edge panels.
Thus \(\Delta \beta_m\) is basically a finite difference of the slope to get an approximate external curvature
Therefore \(d_m/R_m \approx -\Delta \beta_m\), where \(R_m\) is the internal radius of curvature, and we are finally left with

\begin{equation}
	\label{eqn:aplanemm}
	\eqbox{
	a^\text{plane}_{mm}\frac{d_m}{4 \pi R_m} \approx -\frac{\Delta \beta_m}{4 \pi}.
}
\end{equation}







The other curvature that causes a self-induced velocity exists in the \((r,\theta)\) plane, and can be thought of as the effects of an equivalent vortex ring, sometimes referred to as a ``smoke'' ring due to the ease of visualization.
For this component, we start with an approximate expression for the self-induced velocity of a ring vortex as presented by Lamb \cite{Lamb_1945}.\sidenote{Lamb notes/cites that this expression is presented and/or verified by other authors in addition to the derivation he presents.}%book is called Hydrodyanmics, and is in your reading/books directory

\begin{equation}
	\label{eqn:lambvortex}
	v_x = - \frac{1}{4 \pi r_m} \left[ \ln \left(\frac{8 r_m}{a}\right) - \frac{1}{4}\right]
\end{equation}

\where %the negative out front is due to our coordinate system as shown in \cref{fig:axisym_fundamental_geometry}, thus the vortex rings used in our method will induce a velocity in the negative x-direction.
the variable \(a\) in this expression is the cross-sectional radius of the vortex ring.
If we take an element of our vortex sheet of length, \(d_m\), having a total strength of \(\gamma(s_m)d_m\), distributed across the vortex element, we can reasonably imagine this to be analogous to a flattened vortex ring of total perimeter \(2d_m\) and vorticity strength of \(\gamma(s_m)/2\) (see \cref{fig:smokeringselfinduction})
With this assumption in mind, we can relate our vortex sheet to the vortex ring by taking the ring to have the same total perimeter, thus the radius of the equivalent vortex ring would be \(a = d_m / \pi\).
Substituting into \cref{eqn:lambvortex} gives us the expression for the self-induced velocity due to the curvature of the surface in the \((r,\theta)\) plane

\begin{equation}
	v_x = - \frac{1}{4 \pi r_m} \left[ \ln \left(\frac{8 \pi r_m}{d_m}\right) - \frac{1}{4}\right]
\end{equation}

\noindent To apply this now to our panel method, we simply need to remember to multiply by the length and cosine of the angle of the panel on which we are stationed to achieve this portion of the influence coefficient.

\begin{equation}
	\label{eqn:aringmm}
	\eqbox{
	a^\text{ring}_{mm} = - \frac{\cos(\beta_m)d_m}{4 \pi r_m} \left[ \ln \left(\frac{8 \pi r_m}{d_m}\right) - \frac{1}{4}\right]
}
\end{equation}

\begin{figure}[h!]
	\centering
	\includegraphics[width=0.65\textwidth]{./ductape/figures/smokeringselfinduction}
	\caption{Figure displaying panel-vortex ring equivalence. Taken from Lewis \cite{Lewis_1991}.}
	\label{fig:smokeringselfinduction}
\end{figure}



Putting the \(-1/2\) from the original Fredholm equation, and \cref{eqn:aplanemm,eqn:aringmm} together, the self-influence coefficient is

\begin{equation}
	\eqbox{
		a_{mm} = -\frac{1}{2}
		- \frac{\Delta \beta_m}{4 \pi}
		- \left[ \ln \left(\frac{8 \pi r_m}{d_m}\right) - \frac{1}{4} \right] \frac{\cos\left(\beta_m\right)d_m}{4\pi r_m} ,
	}
\end{equation}


\subsection{Implementation for Bodies of Revolution}

TODO: redo everything from here, also update everything before here...

We have everything we need to solve for the vortex strengths on a body of revolution.
Putting things in a matrix form gives us

\begin{equation}
	\label{eqn:axisym_linear_system}
	\begin{pmatrix}
		& & & &  \\
		& & \multirow{3}{*}{\Huge $a_{mn}$}  & &  \\
		& & & &  \\
		& & & &  \\
		& & & &
	\end{pmatrix}
	%
	\begin{pmatrix}
		\gamma_1 \\
		\gamma_2 \\
		\vdots \\
		\gamma_N
	\end{pmatrix}
	=
	\begin{pmatrix}
		-V_\infty\cos \beta_1 \\
		-V_\infty\cos \beta_2 \\
		\vdots \\
		-V_\infty\cos \beta_N \\
	\end{pmatrix},
\end{equation}

\noindent which we can immediately solve for the distribution of \(\gamma\) on an arbitrary body of revolution.
%Note that there is no need to include the Kutta condition for the case of bodies of revolution, just as with other non-lifting bodies (such as symmetric airfoils at zero angle of attack).

\subsection{Implementation for Annular Airfoils (Ducts)}

The implementation for an axisymmetric body offset from the axis of rotation is nearly identical to that for bodies of revolution with two notable exceptions.

\paragraph{1. Back Diagonal Correction}\todo{need to include full derivation/explanation here as to what/why}

Since we have approximated the continuous system through a discretization using a trapezoidal approximation, the system doesn't perfectly predict a net zero circulation around the interior of the surface when we have a non-zero total circulation on the outer surface.
Thus we need to provide a method for preventing circulation ``leakage'' into the interior of the body.
To provide a correction for this, which if done correctly will render the system singular (to be addressed shortly), we apply a correction to the elements along the back diagonal of the coefficient matrix.
This back diagonal correction \cite{Lewis_1991}, applied to each element of the back diagonal is calculated as

\begin{equation}
	a_{N-i+1,i} = - \frac{1}{d_{N-i+1}} \sum\limits^N_{\substack{j=1\\ j\neq N-i+1}} a_{ji}
\end{equation}

\noindent To explain in terms of the matrix, this expression is simply to replace the back diagonal elements with the negative sum of all the other elements in the column, normalized by the panel length of the back diagonal element.
Thus any equation in the system can be found as a summation of the other equations, rendering the matrix singular.
Effectively, this correction removes any ``leakage'' of circulation to the inside of the body, by requiring zero internal circulation.

\paragraph{2. Kutta Condition}

Since applying the back-diagonal correction renders the system singular, we need to find a way to bring it back into a non-singular state in order to solve.
Fortunately, we also need to introduce the Kutta Condition in order to enforce the trailing edge flow conditions.
To apply the Kutta condition, we want the vortex strengths of the panels on either side of the trailing edge to have equal magnitude, but opposite direction such that \(\gamma_1 + \gamma_N = 0\), which allows the flow to leave the trailing edge smoothly.

By demanding that  \(\gamma_1 = - \gamma_N\), we can see that for a given equation in our system, we can combine the 1st and \(N\)th terms such that

\begin{equation}
	(k(s_m, s_1)-k(s_m, s_N))\gamma_1 + k(s_m, s_2)\gamma_2 + \cdots + k(s_m, s_{N-1})\gamma_{N-1} = - V_\infty \cos \beta_m
\end{equation}

By combining the 1st and \(N\)th, terms, we effectively reduce the number of unknowns (and therefore columns) of our system by one.
Removing an unknown also requires the removal of one of the equations.
There are several options, but we choose to subtract the \(N\)th equation from the first equation, similar to what we just did for the columns in the coefficient matrix.
Physically, this approach effectively combines the trailing edge boundary conditions into an average of the flow just downstream of the trailing edge.
By making this adjustment to the coefficient matrix, we also need to apply the same to the right hand side boundary conditions.
Making all these adjustments leaves us with an \(N-1 \times N-1\) system of equations.

To be clear, in the coefficient matrix, we build the \(N\times N\) system, then subtract the \(N\)th column from the first column, then subtract the \(N\)th row from the new first row.
We then use only the first \(N-1\) rows and columns of the matrix for our computation, where the first value in the solution vector is \(\gamma_1=-\gamma_N\), so we can recover the missing value after solving the system.
To give a feel for what the system looks like in matrix form, see the modified components of \cref{eqn:axisym_linear_system} below.

\begin{align}
	A_{mn} &= \begin{pmatrix}
		a_{1,1}-a_{1,N} - (a_{N,1}-a_{N,N}) & \cdots  & a_{1,N-1}-a_{N,N-1} \\
		a_{2,1}- a_{2,N} & \cdots  & a_{2,N-1} \\
		\vdots & \ddots & \vdots \\
		a_{N-1,1}- a_{N-1,N} & \cdots  & a_{N-1,N-1} \\
	\end{pmatrix} \\
	%
	\vect{\gamma} &= \begin{pmatrix}
		\gamma_1-\gamma_N \\
		\gamma_2 \\
		\vdots \\
		\gamma_{N-1} \\
	\end{pmatrix} \\
	%
	RHS &= \begin{pmatrix}
		-V_\infty  (\cos\beta_{1}-\cos\beta_{N} ) \\
		-V_\infty \cos\beta_{2}  \\
		\vdots \\
		-V_\infty \cos\beta_{N-1} \\
	\end{pmatrix}
\end{align}



term\subsection{Duct + Hub System}\todo{re-write this section with more clarity, and add a figure or something}
\label{ssec:ducthubsystem}

Putting a body of revolution and annular airfoil together is a natural extension.
Care must be taken with our subtractive method of applying the Kutta condition, as we now have to take into account the mutual affects of the bodies on each other.
To do so, we apply the same procedure as in the single annular airfoil case, but to the columns and rows of the entire combined system matrix.
This doesn't change anything for the right hand side, though we must be careful to select the correct indices associated with the duct trailing edges.
For the left hand side coefficient matrix, the procedure is also identical, but again, care must be taken in selecting the correct indices, since the first and \(N\)th index associated with the duct is no longer the same as the first and \(N\)th index of the whole system.

After assembling the influence coefficients and applying the Kutta condition, we are left with the system \({A}^{BB} {\gamma}^{B\infty} = {b}^{B\infty}\):

\setcounter{MaxMatrixCols}{20}
\begin{align}
	\label{eqn:multiaxisym}
	{A}^{BB} &= \begin{pmatrix}
		& & & & &  & & & &&   \\
		%
		& & \multirow{2}{*}{\Large $a_{mn}^{dd}$} & & &  & & &\multirow{2}{*}{\Large $a_{mn}^{dh}$} & &  \\
		%
		& & & & &  & & & & & \\
		%
		& & & & &  & & & & & \\
		%
		%
		& & & & & & & & & & \\
		%
		& & \multirow{2}{*}{\Large $a_{mn}^{hd}$} & & & & & & \multirow{2}{*}{\Large $a_{mn}^{hh}$} & & \\
		%
		& & & & & & & & & & \\
		%
		& & & & & & & & & & \\
		%
	\end{pmatrix} \\
	%
	{\gamma}^{B\infty} &= \begin{pmatrix}
		\gamma^d_{1}-\gamma^d_{N}  \\
		\gamma^d_{2} \\
		\vdots \\
		\gamma^d_{N-1}  \\
		%
		\gamma^h_{1}  \\
		\gamma^h_{2} \\
		\vdots \\
		\gamma^h_{N}  \\
	\end{pmatrix} \\
	%
	{b}^{B\infty} &= \begin{pmatrix}
		-V_\infty \cos \beta^d_1 + V_\infty \cos \beta^d_N \\
		- V_\infty \cos \beta^d_2 \\
		\vdots \\
		- V_\infty \cos \beta^d_{N-1} \\
		- V_\infty \cos \beta^h_1 \\
		- V_\infty \cos \beta^h_2 \\
		\vdots \\
		- V_\infty \cos \beta^h_N \\
	\end{pmatrix}
\end{align}

\where the superscripts \(d\) and \(h\) represent the duct (annular airfoil) and hub (body of revolution), respectively.
Also note, for clarity, we will use superscripts to indicate the object being acted upon, and the object acting.
For example, \(A^{BB}\) indicates the influence coefficients on the bodies on themselves,  \(\gamma^{B\infty}\) indicates the vortex strengths on the body, due to the freestream boundary conditions, and \(b^{B\infty}\) are the freestream boundary conditions on the bodies.
We will continue to use this notation moving forward when rotor and wake elements are introduced.


%\subsection{Use in DuctTAPE}
%
%We use this axisymmetric panel method in two places in our duct solver.
%The first is here in the initialization phase, where we compute the no-rotor, potential flow solution in order to initialize the flow field.
%The second will be discussed later as part of outlining the iterative solve procedure (see \cref{sec:iterativesolve}).








%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%                           OTHER COEFFICIENTS

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\section{Pre-Compute Unit Induced Velocities} \todo{rename and re-write this whole section, generalizing things rather than getting into specifics right now.}
%\label{sec:ductcoefficients}
%
%Throughout the solution process, we will need to calculate the velocities at various locations.
%In order to do so, we will need to add the influences of the bodies, wakes, and rotors to the freestream to arrive at the total velocity at a given location.
%In addition, in order to properly couple the rotor, wake, and bodies, we will need to solve a linear system similar to the raw panel method, but with the right hand side augmented with the influences of the rotor and wake on the body panels.
%
%%\subsection{Body-freestream Vortex Coefficients}
%%
%%\Cref{ssec:ducthubsystem} already discussed the calculation of the coefficient matrix associated with the duct-hub system, in other words, the body-freestream vortex coefficients.
%%
%%It should be noted that if we desire to find the surface velocity of the body surface, we simply need to obtain the strength of the vortex panels describing the body.
%
%
%\subsection{Velocities Induced \textit{by} the Bodies}
%
%After we have solved the linear system for the vortex strengths, we immediately know the velocity at the body surface, because vorticity is equal to the difference in velocities just outside and just inside a given vortex sheet.
%Since the internal velocity of the body is zero, the body surface velocity is equivalent to the vorticity at the surface.
%
%\begin{align}
%	\gamma(s)\d s &= (v_{s_\text{out}} - v_{s_\text{in}})\d s \\
%	v_{s_\text{in}} &= 0 \\
%	v_s &= v_{s_\text{out}} =  \gamma(s)
%\end{align}
%
%For velocity off the body, we can simply go back to the induced velocity expressions and for an arbitrary location, calculate the various relative geometries, and multiply by the length and strength of body panels.
%So for an arbitrary field point, \(p=[x_p, r_p]\) the velocity induced in the positive axial and radial directions by the body is
%
%\begin{equation}
%	\begin{aligned}
%		V_{x_{pn}}^\gamma &=  -v_{x_{pn}}^\gamma \gamma_n d_n\\
%		V_{r_{pn}}^\gamma &=  -v_{r_{pn}}^\gamma \gamma_n d_n;
%	\end{aligned}
%\end{equation}
%
%\where the \(v_{x_{pn}}\) and \(v_{r_{pn}}\) are exactly those expressions used for the induced velocity of a unit vortex from \cref{eqn:ringvortexinducedvelocity}, only replacing the \(m\)th point with the field point location when calculating the relative geometries from \cref{eqn:normalizedgeom}.
%
%\subsection{Vortex Induced Velocities \textit{on} the Bodies}
%
%As part of coupling the rotor/wake and panel methods together, we will need to find the values for velocities induced on the body surfaces by non-body elements and combine those with the boundary conditions to find the body surface vortex strengths in the coupled case.
%
%For the wake vortex panels, we again utilize the same induced velocity expressions as we have up to this point:
%
%\begin{equation}
%	\label{eqn:wakeonbodyvelocity}
%	\begin{aligned}
%		V_{x_{mw}}^\gamma &=  -v_{x_{mw}}^\gamma \gamma_w d_w\\
%		V_{r_{mw}}^\gamma &=  -v_{r_{mw}}^\gamma \gamma_w d_w;
%	\end{aligned}
%\end{equation}
%
%\noindent noting that the \(w\)th index is associated with the location of the vortex doing the influencing (at a wake element in this case), and the \(m\)th index is associated with the location of the point being affected (on the body in this case).
%
%In order to properly apply these velocities to the boundary conditions of the linear system for the body vortex strengths, we need to apply the components parallel to the body surface, in accordance with the Dirichlet boundary conditions we have chosen to use.
%
%In this case, we do not assume fully axial flow as we did initially with the freestream to simplify the right hand side of the system of equations.
%With these additional induced velocities, the linear system is expanded to (for the \(m\)th equation)
%
%\begin{equation}
%		\begin{split}
%		\sum_{n=1}^N a_{mn} \gamma_n = -&V_\infty \cos \beta_m \\
%		&- \sum_{w=1}^{W}\left( V_{x_{mw}}^\gamma \cos\beta_m + V_{r_{mw}}^\gamma \sin \beta_m \right)
%		\end{split}
%\end{equation}
%
%\where \(v_{x_{mw}}\) and \(v_{r_{mw}}\) are the velocities induced by the \(w\)th wake element on the \(m\)th body element from \cref{eqn:wakeonbodyvelocity} above.
%
