\documentclass[]{article}

%Move Title Up
\usepackage[T1]{fontenc}
\usepackage{titling}
\setlength{\droptitle}{-10em}   % This is your set screw

%Date Format
\usepackage[]{datetime}
\newdateformat{mydate}{\THEDAY~\monthname[\THEMONTH]~\THEYEAR}

%Bullet Style
%\renewcommand{\labelitemi}{-}


%graphics packages
\usepackage[]{graphicx}
\graphicspath{{./figures/}}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{placeins}
\usepackage{wrapfig}


%mathpackages
\usepackage{amsmath}
\usepackage{amsfonts} 
\usepackage{siunitx}
\usepackage{mathrsfs}
\newcommand{\vect}{\mathbf}
%\newcommand{\vect}{\overset{\rightharpoonup}}
\usepackage{nicefrac}
\usepackage{cancel}
\usepackage{multirow}

%referencing packages
\usepackage{hyperref}
\usepackage[noabbrev]{cleveref}



\title{FLOWFoil Theory Document}

% Your name goes here:
\author{Judd Mehr, }
\date{}



\begin{document}

\maketitle

\noindent \textbf{Last Updated:} \mydate\today

%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Geometry}
\label{sec:geometry}

\subsection{Panels}
\label{ssec:panels}

For any geometric input, we assume that the airfoil geometry begins at the trailing egde and proceeds clockwise around the leading edge and back to the trailing edge.
It is likely convenient to input geometry data that positions the airfoil leading edge at the origin and has a chord length of one.

Linear panels are defined using the input coordinates as the panel end points.
\Cref{fig:linearpanels} shows the geometry convention uses in FLOWFoil as well as the linear paneling of an airfoil.

\begin{figure}[h]
	\centering
	\includegraphics[width=0.5\textwidth]{draft}
	\caption{Linear Paneling (see fig1 in mfoil paper)}
	\label{fig:linearpanels}
\end{figure}


\section{Inviscid Solution Details}
\label{sec:inviscidsolution}


\subsection{Vortex Influence Coefficients}
\label{ssec:vortexinfluencecoefficients}

Following the formulation in \cite{fidkowski_coupled_2022}, the inviscid system is assembled as follows.

\begin{equation}
\begin{aligned}
	\sum_{j=1}^N(a_{ij}\gamma_j) - \Psi_0 &= V_\infty(z_i\cos\alpha - x_i\sin\alpha) \\
	\gamma_1 + \gamma_N &= 0 ~~~~~\mathrm{(Kutta~Condition)}
\end{aligned}
\end{equation}

\noindent or

\begin{equation}
	\mathbf{A} \mathbf{\gamma} = \mathbf{\Psi}^\infty
\end{equation}

\noindent where \(\mathbf{\Psi}^\infty = V_\infty(\vect{z}\cos\alpha - \vect{x} \sin\alpha)\) with \(\alpha\) being the airfoil angle of attack, \(\Psi_0\) is an unknown constant streamfunction at each node, and  \(\mathbf{A}\) is comprized of the coefficients of influence between the panels and evaluation points (\(a_{ij}\)), the Kutta condition, and the influence of \(\Psi_0\).

For a given evaluation point, \(i \in \mathbb{N}^N\), and panel, \(k \in \mathbb{N}^{N-1}\), (comprised of nodes \(j \in \mathbb{N}^{N-1}\) and \(j+1\)) the streamfunction at the evaluation point due to a linear vortex distribution across the panel (with vortex strengths at the nodes of \(\gamma_j\) and \(\gamma_{j+1}\), respectively) is

\begin{equation}
	\Psi_{ik}^\gamma = \mathbf{\Psi}^\gamma_{ik} [\gamma_j, \gamma_{j+1}]^\top,
\end{equation}

\noindent where

\begin{equation}
	\mathbf{\Psi}^\gamma_{ik} = \left[\overline{\psi}^\gamma_{ik} - \widetilde{\psi}^\gamma_{ik}, \widetilde{\psi}^\gamma_{ik} \right]
\end{equation}

\noindent Therefore, the influence coefficient of the \(j\)th node on the \(i\)th node (the \(ij\)th element of \(\mathbf{A}\)) is comprized of portions of the influence seen from each panel of which it is part:

\begin{equation}
	a_{ij} = \begin{cases}
		\overline{\psi}^\gamma_{ij} -  \widetilde{\psi}^\gamma_{ij} & j = 1 \\
		\widetilde{\psi}^\gamma_{i,j-1} & j = N \\
		\widetilde{\psi}^\gamma_{i,j-1} + \left(\overline{\psi}^\gamma_{ij} -  \widetilde{\psi}^\gamma_{ij}\right) & \mathrm{otherwise}.
	\end{cases}
\end{equation}

\noindent Note that panel 1 and panel N-1 do not share nodes 1 and N. That is, node 1 is associated only with panel 1, and node N only with panel N-1. 

\textit{IS EQN 5 CORRECT?  AM I UNDERSTANDING HOW THE MATRIX IS ASSEMBLED??}


\subsubsection{Influence Geometry}

The components of \(\mathbf{\Psi}^\gamma_{ik}\) are defined as 

\begin{align}
	\overline{\psi}^\gamma_{ik} &= \frac{1}{2\pi} \left( h_{ik} (\theta_{i,j+1} - \theta_{ij}) - d_k + a_{ik} \ln(r_{ij}) - (a_{ik}-d_k)\ln(r_{i,j+1}) \right) \\
	\widetilde{\psi}^\gamma_{ik} &= \frac{a_{ik}}{d_k}\overline{\psi}^\gamma_{ik} + \frac{1}{4\pi d_k} \left(r^2_{i,j+1} \ln(r_{i,j+1}) - r^2_{ij} \ln(r_{ij}) - \frac{1}{2}r^2_{i,j+1} + \frac{1}{2}r^2_{ij} \right).
\end{align}
\noindent In order to evaluate the the componenets of \(\mathbf{\Psi}^\gamma_{ik}\) we will need to understand the geometry of the problem.

\begin{figure}[h]
	\centering
	\includegraphics[width=0.5\textwidth]{draft}
	\caption{Influence Geometry (see fig10 in mfoil paper)}
	\label{fig:influencegeometry}
\end{figure}

\Cref{fig:influencegeometry} shows the relative geometry for the problem, and we calculate each of the geometric values as follows.

\begin{itemize}
	\item The \(k\)th panel vector and length, from the \(j\)th to \(j+1\)th node:
	\begin{align}
		\vect{d}_k &= \vect{n}_{j+1} - \vect{n}_j \\
		d_k &= || \vect{n}_{j+1} - \vect{n}_j ||,
	\end{align}
	\noindent where \(\vect{n}\) is the node position.
	%
	%
	\item The vector and distance from the \(j\)th node to the evaluation point:
	\begin{align}
		\vect{r}_{ij} &= \vect{p}_i - \vect{n}_j \\
		r_{ij} &= ||\vect{p}_i - \vect{n}_j||,
	\end{align}
	\noindent where \(\vect{p}\) is the evaluation point position.
	%
	%
	\item The angles between the \(k\)th panel and the evaluation point centered at the \(j\)th node:
	\begin{equation}
		\theta_{ij} = \cos^{-1}\left( \frac{\vect{r}_{ij} \cdot \vect{d}_k}{r_{ij}d_k} \right)
	\end{equation}
	%
	%
	\item The height of the triangle made from the evaluation point and \(j\)th and \(j+1\)th nodes:
	\begin{equation}
		h_{ik} = 2A_{ik}/d_k,
	\end{equation}
	\noindent where \(A_{ik} = \left[ s_{ik} (s_{ik} - d_k) (s_{ik} - r_j) (s_{ik} - r_{j+1}) \right]^{1/2} \), with \(s_{ik} = (d_k + r_{ij} + r_{i,j+1})/2\) (this is Heron's formula for the area of a triangle).
	%
	%
	\item The length of the base (colinear with the panel) of the right triangle of height, \(h_{ik}\):
	\begin{equation}
		a_k = \begin{cases}
			r_{ij} \cos(\pi - \theta_{ij}) + d_k & \mathrm{if}~~ \theta_{ij} > \frac{\pi}{2} \\
			d_k & \mathrm{if}~~ \theta_{ij} = \frac{\pi}{2} \\
			r_{ij}\cos(\theta_{ij}) & \mathrm{otherwise.} 
		\end{cases}
	\end{equation}
	%
	%
	\item The natural log of the distance between node and evaluation point:
	\begin{equation}
		\ln(r_{ij}) = \begin{cases}
			0 & \mathrm{if}~~ r_{ij} = 0 \\
			\ln(r_{ij}) & \mathrm{otherwise.}
		\end{cases}
	\end{equation}
\end{itemize}


\subsubsection{Completing the Coefficient Matrix}

To complete the coefficient matrix, \(\mathbf{A}\) after putting together the vortex influence coefficients, we need to first add in the contribution of the unknown constant, \(\Psi_0\).  We do this by adding a column of -1's to the current \(N \times N\) matrix of coefficients

\begin{equation}
\begin{pmatrix}
	& & & & & -1 \\
	& & \multirow{3}{*}{\Huge $a_{ij}$}  & & & -1 \\
	& & & & & -1 \\
	& & & & & -1 \\
	& & & & & -1
\end{pmatrix}.
\end{equation}

\noindent We then add in the kutta condition, \(\gamma_1 + \gamma_N = 0\), as an additional row to our matrix

 \begin{equation}
 	\begin{pmatrix}
 		& & & & & -1 \\
 		& & \multirow{3}{*}{\Huge $a_{ij}$}  & & & -1 \\
 		& & & & & -1 \\
 		& & & & & -1 \\
 		& & & & & -1 \\
 		1 & 0 & \cdots & 0 & 1 & 0
 	\end{pmatrix}.
 \end{equation}

We now have an \(N+1 \times N+1 \) system of equations for \(\gamma\) and \(\Psi_0\)

 \begin{equation}
	\begin{pmatrix}
		& & & & & -1 \\
		& & \multirow{3}{*}{\Huge $a_{ij}$}  & & & -1 \\
		& & & & & -1 \\
		& & & & & -1 \\
		& & & & & -1 \\
		1 & 0 & \cdots & 0 & 1 & 0
	\end{pmatrix}
%
	\begin{pmatrix}
		\gamma_1 \\
		\gamma_2 \\
		\vdots \\
		\gamma_N \\
		\Psi_0 \\
	\end{pmatrix}
=
	\begin{pmatrix}
		V_\infty(z_1\cos\alpha - x_1 \sin\alpha) \\
		V_\infty(z_2\cos\alpha - x_2 \sin\alpha) \\
		\vdots \\
		V_\infty(z_N\cos\alpha - x_N \sin\alpha) \\
		0
	\end{pmatrix}
\end{equation}


\subsubsection{Trailing Edge Treatment}

We have a few modifications to make to our system depending on whether the airfoil has a blunt or sharp trailing edge.

\paragraph{Sharp Trailing Edge}

In the case of the sharp trailing edge, the first and last nodes are coincident, which leads them to have identical equations, causing the matrix to be singular.  In this case, we discard the \(N\)th row and substitute it for an extrapolation of the mean (between upper and lower sides) to the trailing edge as

\begin{equation}
	\gamma_1 + 2\gamma_2 - \gamma_3 + \gamma_{N-2} - 2\gamma_{N-1} - \gamma_N = 0.
\end{equation}

\noindent This gives us the \(N\)th row of the coefficient matrix to be

\begin{equation}
	\begin{bmatrix}
		1 & 2 & -1 & 0 & \cdots & 0 & 1 & -2 & -1 & 0 
	\end{bmatrix}.
\end{equation}


\noindent (Where the \(N+1\)th entry is set to zero, since \(-\Psi_0\) was already applied at node 1.) We also set the \(N\)th boundary condition value to be 0 (rather than \(V_\infty[z_N\cos\alpha - x_N \sin\alpha]\)). 
This yields the following system of equations for the inviscid solution of an airfoil with a sharp trailing edge:

 \begin{equation}
 	\begin{split}
&	\begin{pmatrix}
		a_{11} & a_{12} & & & \cdots & & & a_{1,N-1} & a_{1N} & -1 \\
		a_{21} & a_{22} & & & \cdots & & & a_{2,N-1} & a_{2N} & -1 \\
		\vdots & \vdots & & & \ddots & & & \vdots & \vdots & -1 \\
		a_{N-1,1} & a_{N-1,2} & & & \cdots & & & a_{N-1,N-1} & a_{N-1,N} & -1 \\
		1 & 2 & -1 & 0 & \cdots & 0 & 1 & -2 & -1 & 0 \\
		1 & 0 & 0 & 0 & \cdots & 0 & 0 & 0 & 1 & 0
	\end{pmatrix}
	%
	\begin{pmatrix}
		\gamma_1 \\
		\gamma_2 \\
		\vdots \\
		\gamma_{N-1} \\
		\gamma_N \\
		\Psi_0 \\
	\end{pmatrix}
	= \\
	& \hspace{2cm}\begin{pmatrix}
		V_\infty(z_1\cos\alpha - x_1 \sin\alpha) \\
		V_\infty(z_2\cos\alpha - x_2 \sin\alpha) \\
		\vdots \\
		V_\infty(z_{N-1}\cos\alpha - x_{N-1} \sin\alpha) \\
		0 \\
		0
	\end{pmatrix}
\end{split}
\end{equation}

\paragraph{Blunt Trailing Edge}






\newpage

\bibliography{ref}{}
\bibliographystyle{aiaa}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\vspace{1cm}
\hrule
\vspace{1cm}

\noindent  \textbf{Change Log:}

\begin{itemize}
	\item (date): change(s)
\end{itemize}



\end{document}
